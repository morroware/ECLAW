# === Remote Claw Machine Configuration ===
#
# Copy this file to .env and edit to match your setup:
#   cp .env.example .env
#
# For a quick PoC demo with short timers, use:
#   cp .env.demo .env

# === Timing ===
TRIES_PER_PLAYER=2
TURN_TIME_SECONDS=90
TRY_MOVE_SECONDS=30
POST_DROP_WAIT_SECONDS=8
READY_PROMPT_SECONDS=15
QUEUE_GRACE_PERIOD_SECONDS=300

# === Win Sensor ===
WIN_SENSOR_ENABLED=true

# === GPIO Pulse/Hold ===
COIN_PULSES_PER_CREDIT=2
COIN_PULSE_MS=150
DROP_PULSE_MS=200
DROP_HOLD_MAX_MS=10000
MIN_INTER_PULSE_MS=500
DIRECTION_HOLD_MAX_MS=30000
COIN_EACH_TRY=true

# === Control ===
COMMAND_RATE_LIMIT_HZ=25
DIRECTION_CONFLICT_MODE=ignore_new

# === Pins (BCM numbering) ===
PIN_COIN=17
PIN_NORTH=27
PIN_SOUTH=5
PIN_WEST=6
PIN_EAST=24
PIN_DROP=25
PIN_WIN=16

# Relay polarity: true for active-low boards (e.g. SainSmart 8-channel)
RELAY_ACTIVE_LOW=true

# === Server ===
# Listen on all interfaces so the server is reachable on port 8000 from
# other devices on the network. In production behind nginx, you may
# restrict to 127.0.0.1 so only nginx can reach the app directly.
HOST=0.0.0.0
PORT=8000
DATABASE_PATH=./data/claw.db
# IMPORTANT: Change this to a strong random value in production!
ADMIN_API_KEY=changeme
# Comma-separated list of allowed browser origins for API calls
CORS_ALLOWED_ORIGINS=http://localhost,http://127.0.0.1
# Comma-separated CIDRs of trusted reverse proxies. When set, the server
# trusts X-Forwarded-For from matching IPs for rate limiting.
# Required when running behind nginx. Empty = ignore X-Forwarded-For.
TRUSTED_PROXIES=127.0.0.1/32,::1/128

# === Embed ===
# Comma-separated origins allowed to frame the embed pages in iframes.
# Required for WordPress or other sites to embed the stream/player.
# Example: EMBED_ALLOWED_ORIGINS=https://mysite.com,https://www.mysite.com
# Leave empty to allow all origins (frame-ancestors *).
EMBED_ALLOWED_ORIGINS=

# === WLED (optional LED strip integration) ===
# Enable WLED integration. Requires WLED_DEVICE_IP to be set.
WLED_ENABLED=false
WLED_DEVICE_IP=
# Preset IDs to trigger on game events (0 = disabled).
# Configure presets in the WLED web UI, then reference their IDs here.
WLED_PRESET_WIN=0
WLED_PRESET_LOSS=0
WLED_PRESET_DROP=0
WLED_PRESET_START_TURN=0
WLED_PRESET_IDLE=0
WLED_PRESET_EXPIRE=0
WLED_PRESET_GRAB=0
# Seconds to show win/loss/drop/grab/expire before reverting to idle preset.
WLED_RESULT_DISPLAY_SECONDS=5

# === Watchdog ===
WATCHDOG_HEALTH_URL=http://127.0.0.1:8000/api/health
WATCHDOG_CHECK_INTERVAL_S=2
WATCHDOG_FAIL_THRESHOLD=3

# === Stream ===
MEDIAMTX_HEALTH_URL=http://127.0.0.1:8889/v3/paths/list
CAMERA_DEVICE=0

# === PoC Mode ===
# Set to true to run without real GPIO hardware (uses mock/logging)
# Set to false for real Pi 5 hardware
MOCK_GPIO=true
# gpiozero backend (Pi 5: lgpio is required for reliable hardware access)
# GPIOZERO_PIN_FACTORY=lgpio

# === DB Maintenance ===
DB_RETENTION_HOURS=48

# === WebSocket Limits ===
# Status hub (broadcast to all viewers)
MAX_STATUS_VIEWERS=500
STATUS_SEND_TIMEOUT_S=5.0
STATUS_KEEPALIVE_INTERVAL_S=30
# Control handler (per-player authenticated channel)
MAX_CONTROL_CONNECTIONS=100
CONTROL_SEND_TIMEOUT_S=2.0
CONTROL_PING_INTERVAL_S=20
CONTROL_LIVENESS_TIMEOUT_S=60
CONTROL_PRE_AUTH_TIMEOUT_S=2.0
CONTROL_MAX_MESSAGE_BYTES=1024

# === MJPEG / Camera ===
MAX_MJPEG_STREAMS=20
MJPEG_FPS=30
CAMERA_WIDTH=1280
CAMERA_HEIGHT=720
CAMERA_FPS=30
CAMERA_WARMUP_FRAMES=5
CAMERA_MAX_CONSECUTIVE_FAILURES=100
CAMERA_JPEG_QUALITY=80

# === Rate Limiting ===
RATE_LIMIT_WINDOW_S=3600
RATE_LIMIT_SWEEP_INTERVAL_S=600
JOIN_RATE_PER_IP=30
JOIN_RATE_PER_EMAIL=15
HEALTH_CHECK_TIMEOUT_S=2.0
HISTORY_LIMIT=20

# === Database Tuning ===
DB_BUSY_TIMEOUT_MS=5000

# === Background Task Intervals ===
DB_PRUNE_INTERVAL_S=3600
RATE_LIMIT_PRUNE_AGE_S=3600
QUEUE_CHECK_INTERVAL_S=10

# === State Machine Internals ===
GHOST_PLAYER_AGE_S=30
COIN_POST_PULSE_DELAY_S=0.5
EMERGENCY_STOP_TIMEOUT_S=10.0
TURN_END_STUCK_TIMEOUT_S=30

# === GPIO Executor Timeouts ===
GPIO_OP_TIMEOUT_S=2.0
GPIO_PULSE_TIMEOUT_S=5.0
GPIO_INIT_TIMEOUT_S=10.0
